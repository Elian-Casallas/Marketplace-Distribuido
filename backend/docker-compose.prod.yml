version: '3.9'

services:
  # ============================
  # üåê GATEWAY
  # ============================
  main-api:
    build: ./marketplace-api
    container_name: main-api
    ports:
      - "8000:8000"
    env_file:
      - ./marketplace-api/.env
    volumes:
      - main_api_app:/var/www/html
    depends_on:
      - mongo_main
      - electronics-app
      - clothes-app
      - home-app
    networks:
      - gateway_main
      - gateway_electronics
      - gateway_clothes
      - gateway_home

  mongo_main:
    image: mongo:6
    container_name: mongo_main
    ports:
      - "27020:27017"
    volumes:
      - mongo_main_data:/data/db
    networks:
      - gateway_main

  # ============================
  # üß† REDIS
  # ============================
  redis:
    image: redis:7
    container_name: redis_main
    networks:
      - gateway_main
      - gateway_electronics
      - gateway_clothes
      - gateway_home

  # ============================
  # ‚ö° ELECTRONICS NODE
  # ============================
  electronics-app:
    build: ./marketplace-electronics
    container_name: electronics-app
    env_file:
      - ./marketplace-electronics/.env
    volumes:
      - electronics_app:/var/www/html
    depends_on:
      - mongo_electronics
    networks:
      - gateway_electronics

  mongo_electronics:
    image: mongo:6
    container_name: mongo_electronics
    volumes:
      - mongo_electronics_data:/data/db
    networks:
      - gateway_electronics

  # ============================
  # üëï CLOTHES NODE
  # ============================
  clothes-app:
    build: ./marketplace-clothes
    container_name: clothes-app
    env_file:
      - ./marketplace-clothes/.env
    volumes:
      - clothes_app:/var/www/html
    depends_on:
      - mongo_clothes
    networks:
      - gateway_clothes

  mongo_clothes:
    image: mongo:6
    container_name: mongo_clothes
    volumes:
      - mongo_clothes_data:/data/db
    networks:
      - gateway_clothes

  # ============================
  # üè† HOME NODE
  # ============================
  home-app:
    build: ./marketplace-home
    container_name: home-app
    env_file:
      - ./marketplace-home/.env
    volumes:
      - home_app:/var/www/html
    depends_on:
      - mongo_home
    networks:
      - gateway_home

  mongo_home:
    image: mongo:6
    container_name: mongo_home
    volumes:
      - mongo_home_data:/data/db
    networks:
      - gateway_home

# ============================
# üì¶ VOLUMES
# ============================
volumes:
  main_api_app:
  electronics_app:
  clothes_app:
  home_app:
  mongo_main_data:
  mongo_electronics_data:
  mongo_clothes_data:
  mongo_home_data:

# ============================
# üåç REDES PRIVADAS
# ============================
networks:
  gateway_main:
  gateway_electronics:
  gateway_clothes:
  gateway_home: